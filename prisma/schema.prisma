generator client {
  provider = "prisma-client"
  output   = "../generated/prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                          String    @id @default(cuid())
  email                       String    @unique
  name                        String
  password                    String
  phone                       String?
  streetAddress               String?
  city                        String?
  country                     String?
  province                    String?
  state                       String?
  postalCode                  String?
  zipCode                     String?
  role                        UserRole  @default(CUSTOMER)
  emailVerifiedAt              DateTime?
  emailVerificationToken      String?
  emailVerificationExpiresAt  DateTime?
  passwordResetToken          String?
  passwordResetExpiresAt      DateTime?
  createdAt                   DateTime  @default(now())
  updatedAt                   DateTime  @updatedAt

  bookings     Booking[]
  staffProfile Staff?

  @@map("users")
}

model Service {
  id              String  @id @default(cuid())
  name            String
  slug            String  @unique
  description     String  @db.Text
  durationMinutes Int
  price           Decimal @db.Decimal(10, 2)
  isActive        Boolean @default(true)

  staffServices StaffService[]
  bookings      Booking[]

  @@map("services")
}

model Staff {
  id       String  @id @default(cuid())
  userId   String  @unique
  bio      String  @db.Text
  imageUrl String?

  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  staffServices StaffService[]
  workingHours  WorkingHours[]
  bookings      Booking[]

  @@map("staff")
}

model StaffService {
  id        String @id @default(cuid())
  staffId   String
  serviceId String

  staff   Staff   @relation(fields: [staffId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([staffId, serviceId])
  @@map("staff_services")
}

model WorkingHours {
  id          String  @id @default(cuid())
  staffId     String
  dayOfWeek   Int
  startTime   String
  endTime     String
  isAvailable Boolean @default(true)

  staff Staff @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@unique([staffId, dayOfWeek])
  @@map("working_hours")
}

model Booking {
  id         String        @id @default(cuid())
  userId     String?
  guestEmail String?
  guestName  String?
  guestPhone String?
  serviceId  String
  staffId    String
  startTime  DateTime
  endTime    DateTime
  status     BookingStatus @default(CONFIRMED)
  notes      String?       @db.Text
  cancelledAt DateTime?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  user    User?   @relation(fields: [userId], references: [id], onDelete: SetNull)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Restrict)
  staff   Staff   @relation(fields: [staffId], references: [id], onDelete: Restrict)

  @@index([userId])
  @@index([guestEmail])
  @@index([staffId, startTime])
  @@map("bookings")
}

enum UserRole {
  CUSTOMER
  STAFF
  ADMIN
}

enum BookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}
